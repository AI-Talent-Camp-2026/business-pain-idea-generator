# ADR-001: Асинхронный прогон генерации

**Статус:** Accepted  
**Дата:** 2026-02-03

## Контекст

Ключевая операция продукта — “прогон” (сбор сигналов → формулировка болей → генерация 10–20 идей → аналоги → план/сроки). Эта операция может занимать минуты и имеет непредсказуемую длительность в зависимости от источников и объёма анализа. При этом UX‑требование: пользователь должен запускать прогон “без лишних вопросов” и не сталкиваться с зависанием интерфейса.

Дополнительные ограничения из Brief, влияющие на решение:
- первая рабочая версия — за 1 день (нужен надёжный базовый поток, без тонкой настройки);
- бюджет на модели ограничен уже оплаченной подпиской (важна предсказуемость и контроль нагрузки).

Ссылки: NFR (время “до результата” Bronze/Silver/Gold), USM (US‑001, SS‑001), Journey (фаза ожидания).

## Решение

Сделать прогон **асинхронным**:
- запуск возвращает идентификатор прогона сразу;
- выполнение проходит в фоне (через очередь задач и воркеры);
- UI показывает статус и этапы прогресса;
- результаты становятся доступными по готовности.

## Обоснование

- UX не зависит от “тяжёлой” операции; пользователь может ждать без тревоги, понимая этапы.
- Можно масштабировать нагрузку на анализ отдельно от нагрузки UI/API.
- Проще обрабатывать ошибки источников: прогон может завершиться с частичным результатом и честной маркировкой.

## Альтернативы

### Синхронный прогон
- **Плюсы:** проще реализация.
- **Минусы:** высокий риск таймаутов, “зависания”, плохой UX.
- **Почему отвергли:** противоречит требованиям по ожиданию и масштабированию.

### Асинхронность без прогресса (только “ждите”)
- **Плюсы:** проще, чем полноценный прогресс.
- **Минусы:** падает доверие (“что там происходит?”), выше вероятность отвала.
- **Почему отвергли:** продукт критично зависит от доверия.

## Последствия

### Положительные
- Устойчивость UX при тяжёлых прогонах.
- Возможность параллельной обработки и приоритизации задач.

### Trade-offs
- Появляется потребность в статусах, событиях и обработке отмены/повтора.
- Нужно продумать лимиты (rate limiting), чтобы избежать “DDOS самим собой”.

### Требует внимания
- Определить понятные этапы прогресса (человеческий язык, не технический).
- Решить, допускается ли частичный результат (например, идеи без аналогов) и как это маркировать.

## Связанные решения

- ADR-002: Прозрачность через “сигналы/доказательства”
